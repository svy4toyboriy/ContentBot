# ContentDealerBot

## Апгрейднутая версия musicDealer, поддерживающая отправку mp4-файлов и работающая с БД.

**Задача:**

Разработать такого чат-бота, с помощью которого можно было бы быстро и удобно искать видео на YouTube прямо в Telegram и скачивать контент в видео- или аудио-формате, исходя из своего запроса, для дальнейшего просмотра/прослушивания или скачивания для проигрывания в режиме оффлайн. 

**Решение:**

Преимуществом данного бота по сравнению с другими схожими является тот факт, что для скачивания не потребуется самому находить ссылку на видео, поскольку его можно найти через поиск в самом боте, который задействует для этого официальный Youtube API. Таким образом, для осуществления скачивания не будет необходимости использовать что-то, помимо самого бота. 

Помимо прочего, пользователю легко сменить формат получаемого контента, введя лишь одну команду, без необходимости при каждом скачивании уточнять формат. Бот поддерживает смену языков, а также хранит данные о запросах в PostgreSQL, в частности, для того, чтобы отслеживать невыполненные запросы для их последующего осуществления.  

Таким образом, бот становится ответственным за обработку запроса на поиск пользователя, смену языка, смену формата, запроса в каталог YouTube, выдачу результатов в виде списка кнопок и, после выбора пользователем определённого варианта, бот начинает скачивание и отсылку файла пользователю, попутно занося данные в БД.

Бот развернут и запущен на облачном сервере Selectel. Также написан небольшой скрипт для отслеживания объема скачанных за все время файлов, которые удаляет наиболее старые файлы, чтобы не происходило переполнение диска. 

**Описание работы:**

Файл TelegramBot.java - ответственный за инициализацию бота, обработку запросов, отсылку сообщений и большую часть всей бизнес-логики. 

Buttons.java используется для конструирования списка кнопок выбора контента. 

YouTube.java – для запроса в каталог YouTube. 

Console.java – для непосредственного скачивания файла на сервер при помощи вспомогательной утилиты yt-dlp. 

Database.java - для инициализации и подключения к базе данных + для добавления в нее данных о запросах.

Предварительно был создан, настроен и запущен в работу бот с помощью BotFather, включая получение API-ключа от телеграма, а также создан проект на developers.google для получения API-ключа YouTube. 

Работу бота можно разбить на следующие этапы:
1)	Получение от пользователя команды /start, после чего бот сообщает о том, что он готов к работе. Далее пользователь выбирает язык общения. По умолчанию выбран формат контента - аудио. Его всегда можно легко сменить соответствующей командой /video и обратно /audio.
  
2) Далее пользователь вводит свой запрос – так, как он бы делал будучи на сайте YT – чего угодно, далее бот делает http-запрос на платформу YouTube для поиска подходящего под запрос контента, выделяет из него название, идентификатор, составляет ссылку для всех вариантов, а затем присылает результат в виде списка кнопок.
  
3)	Затем пользователь, нажав на одну из кнопок, делает свой выбор, и бот начинает процесс скачивания соответствующего контента в выбранном формате с помощью специально сконструированного запроса в утилиту yt-dlp, предварительно оповестив пользователя об этом. По завершении скачивания, оповещает об этапе отправляния и начинает загрузку только-только скачанного файла непосредственно в чат к пользователю. В случае, если на этапе скачивания или отправки пойдет что-то не так, бот оповестить об этом соответствующим сообщением.
   
4)	Готово. Бот успешно отправил пользователю скачал и отправил пользователю видео в нужном формате. 

**Примеры работы:**

Запуск бота и выбор английского языка
![Screenshot_1](https://github.com/user-attachments/assets/0878b30c-bca2-4a1e-8aa7-67453a629b03)


Выбора формата
![Screenshot_2](https://github.com/user-attachments/assets/9a5602cd-a161-43e5-b6db-160eba470b88)


Поиск по запросу и выбор кнопки №1
![Screenshot_3](https://github.com/user-attachments/assets/1935816e-9e6e-4a84-aa02-69abb3fec628)


![Screenshot_4](https://github.com/user-attachments/assets/cf546eb4-08c7-4556-bd88-c19395aae48c)


Смена формата и новый запрос
![Screenshot_5](https://github.com/user-attachments/assets/adb207be-272a-413b-8005-89bbb04a32a2)


![Screenshot_6](https://github.com/user-attachments/assets/9ee32637-3812-44fa-a314-3061fa2bc01e)


Если скачать контент невозможно, например, слишком большой вес файла, то бот уведомляет об этом
![Screenshot_7](https://github.com/user-attachments/assets/2107076c-6b0d-40a1-823b-2731a6dd8e96)

















